@using his.ViewModel;
@model PatientViewModel;
@{
    ViewData["Title"] = "Danh sách người bệnh";
    var date = DateTime.Now.AddYears(-10).ToString("yyyy-MM-dd");
    var admissionDate = DateTime.Now.ToString("yyyy-MM-ddTHH:mm");
    var patients = Model.Patients;
    var departments = Model.Departments;
    var emrTypes = Model.EmrTypes;
}

<!-- Breadcrumb -->
<div class="page-header">
    <h3 class="fw-bold mb-3">Người bệnh</h3>
    <ul class="breadcrumbs mb-3">
        <li class="nav-home">
            <a href="/">
                <i class="icon-home"></i>
            </a>
        </li>
        <li class="separator">
            <i class="icon-arrow-right"></i>
        </li>
        <li class="nav-item">
            <a href="/patients">Người bệnh</a>
        </li>
    </ul>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex align-items-center">
                    <h4 class="card-title m-3">Danh sách người bệnh</h4>
                    <button type="button" class="btn btn-primary btnTiepNhan" data-bs-toggle="modal" data-bs-target="#modalTiepNhan">
                        <i class="fas fa-plus"></i> Tiếp Nhận Người Bệnh
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table id="add-row" class="display table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Mã NB</th>
                                <th>Họ tên</th>
                                <th>Ngày sinh</th>
                                <th>Khoa phòng</th>
                                <th>Mã nhập viện/BA</th>
                                <th>Thời gian nhập khoa</th>
                                <th>Giới tính</th>
                                <th>Ngày sinh</th>
                                <th style="width: 10%">Chức năng</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var p in patients)
                            {
                                <tr>
                                    <td>@p.PatientCode</td>
                                    <td>@p.FullName</td>
                                    <td>@p.DateOfBirth.ToString("yyyy-MM-dd HH:mm")</td>
                                    <td>@p.DepartmentName</td>
                                    <td>@p.AdmissionCode</td>
                                    <td>@p.AdmissionDate?.ToString("yyyy-MM-dd HH:mm")</td>
                                    <td>@p.Gender</td>
                                    <td>@p.DateOfBirth.ToString("dd/MM/yyyy")</td>
                                    <td>
                                        <div class="form-button-action">
                                            <button type="button" class="btn btn-success btn-xs btnChiDinh m-2"
                                                    data-mabenhnhan="@p.PatientCode"
                                                    data-hoten="@p.FullName"
                                                    data-gioitinh="@p.Gender"
                                                    data-makhoa="@p.DepartmentCode" data-bs-toggle="modal" data-bs-target="#modalChiDinh">
                                                Chỉ Định
                                            </button>
                                            <button type="button" class="btn btn-primary btn-xs btnKeThuoc m-2"
                                                    data-mabenhnhan="@p.PatientCode"
                                                    data-hoten="@p.FullName"
                                                    data-gioitinh="@p.Gender"
                                                    data-makhoa="@p.DepartmentCode" data-bs-toggle="modal" data-bs-target="#modalKeThuoc">
                                                Kê thuốc
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modalTiepNhan" tabindex="-1" aria-labelledby="modalTiepNhanLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form id="formTiepNhan">
                <div class="modal-header">
                    <h5 class="modal-title" id="tiepNhanModalLabel">Tiếp Nhận Người Bệnh</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="tenkhoa" name="tenkhoa" />
                    <input type="hidden" id="loaiba" name="loaiba" />
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Mã Bệnh Nhân</label>
                            <input type="text" class="form-control" id="mabenhnhan" name="mabenhnhan" readonly />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Họ và Tên</label>
                            <input type="text" class="form-control" id="hoten" name="hoten" />
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Ngày Sinh</label>
                            <input type="date" class="form-control" id="ngaysinh" name="ngaysinh" />
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Giới Tính</label>
                            <select class="form-select" id="gioitinh" name="gioitinh">
                                <option value="Nam">Nam</option>
                                <option value="Nữ">Nữ</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">CMND/CCCD</label>
                            <input type="text" class="form-control" id="cccdso" name="cccdso" />
                        </div>
                        <div class="col-md-8">
                            <label class="form-label">Địa Chỉ</label>
                            <input type="text" class="form-control" id="diachi" name="diachi" />
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Mã BHYT</label>
                            <input type="text" class="form-control" id="mabhyt" name="mabhyt" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Người Nhà Liên Hệ</label>
                            <input type="text" class="form-control" id="hotennguoithan" name="hotennguoithan" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">SĐT Người Nhà</label>
                            <input type="text" class="form-control" id="sodienthoainguoithan" name="sodienthoainguoithan" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Khoa Điều Trị</label>
                            <select class="form-select" id="makhoa" name="makhoa">
                                <option value="">-- Chọn khoa --</option>
                                @foreach (var department in departments)
                                {
                                    <option value="@department.Code">@department.Value</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Loại bệnh án</label>
                            <select class="form-select" id="maloaiba" name="maloaiba">
                                <option value="">-- Chọn bệnh án --</option>
                                @foreach (var emr in emrTypes)
                                {
                                    <option value="@emr.Code">@emr.Value</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Lý Do Vào Viện</label>
                            <input type="text" class="form-control" id="lydovaovien" name="lydovaovien" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Chẩn Đoán Vào Viện</label>
                            <input type="text" class="form-control" id="chandoanvaovien" name="chandoanvaovien" />
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-check"></i> Nhập Viện/Nhập Khoa</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-undo-alt"></i> Hủy</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="modalChiDinh" tabindex="-1" aria-labelledby="modalChiDinhLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form id="formChiDinh">
                <div class="modal-header">
                    <h5 class="modal-title">Phiếu Chỉ Định Cận Lâm Sàng</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
                </div>
                <div class="modal-body">

                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="mabenhnhan" class="form-label">Mã bệnh nhân</label>
                            <input type="text" class="form-control" id="mabenhnhan" name="mabenhnhan" required />
                        </div>
                        <div class="col-md-6">
                            <label for="TenBenhNhan" class="form-label">Tên bệnh nhân</label>
                            <input type="text" class="form-control" id="hoten" name="hoten" required />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Giới Tính</label>
                            <select class="form-select" id="gioitinh" name="gioitinh">
                                <option value="Nam">Nam</option>
                                <option value="Nữ">Nữ</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="makhoa" class="form-label">Khoa</label>
                            <select class="form-select" id="makhoa" name="makhoa">
                                <option value="">-- Chọn khoa --</option>
                                @foreach (var department in departments)
                                {
                                    <option value="@department.Code">@department.Value</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="bacsichidinh" class="form-label">Bác sĩ chỉ định</label>
                            <select class="form-select" id="bacsichidinh" name="bacsichidinh">
                                <option value="Lê Đức Anh">Lê Đức Anh</option>
                                <option value="Nguyễn Văn Thành">Nguyễn Văn Thành</option>
                                <option value="Trần Ái My">Trần Ái My</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Dịch vụ cận lâm sàng</label>
                            <div class="mb-3">
                                <input type="text" class="form-control" id="searchDichVuCls" placeholder="Tìm kiếm dịch vụ...">
                            </div>
                            <div class="scrollbar">
                                <table class="table table-bordered table-responsive" id="tableDichVu">
                                    <thead>
                                        <tr>
                                            <th>Chọn</th>
                                            <th>Tên dịch vụ</th>
                                            <th>Đơn giá (VNĐ)</th>
                                            <th>Số lượng</th>
                                            <th>Ghi chú</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>

                            </div>
                            
                            <div class="text-end mt-2">
                                <strong>Tổng tạm tính: </strong>
                                <span id="tongTienTamTinh">0</span> VNĐ
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" id="submitPhieuCls" class="btn btn-primary"><i class="fas fa-check"></i> Lưu phiếu</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="fas fa-undo-alt"></i> Hủy</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="~/js/patient.js"></script>
}

